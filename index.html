<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Games Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .main-content {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .games-section {
            flex: 2;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .game-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .game-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .game-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
        }

        .game-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .game-description {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .high-scores {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .high-scores h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3em;
        }

        .score-list {
            list-style: none;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .controls-info h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .control-item {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .game-screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .game-canvas {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
        }

        canvas {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: #000;
        }

        .microbit-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            font-size: 0.8em;
        }

        .connected { background: rgba(0, 255, 0, 0.3); }
        .disconnected { background: rgba(255, 0, 0, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <div class="microbit-status disconnected" id="microbitStatus">
            Microbit: Disconnected
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="main-screen">
            <div class="header">
                <h1>üéÆ School Games Platform</h1>
                <p>Choose a game to play and compete for high scores!</p>
            </div>

            <div class="main-content">
                <div class="games-section">
                    <div class="game-card" data-game="pong">
                        <span class="game-icon">üèì</span>
                        <div class="game-title">Pong</div>
                        <div class="game-description">Classic paddle game</div>
                    </div>

                    <div class="game-card" data-game="snake">
                        <span class="game-icon">üêç</span>
                        <div class="game-title">Snake</div>
                        <div class="game-description">Eat and grow longer</div>
                    </div>

                    <div class="game-card" data-game="flappybird">
                        <span class="game-icon">üê¶</span>
                        <div class="game-title">Flappy Bird</div>
                        <div class="game-description">Navigate through pipes</div>
                    </div>

                    <div class="game-card" data-game="rhythmtimer">
                        <span class="game-icon">üéµ</span>
                        <div class="game-title">Rhythm Timer</div>
                        <div class="game-description">Match the beat</div>
                    </div>

                    <div class="game-card" data-game="stopthesprite">
                        <span class="game-icon">üéØ</span>
                        <div class="game-title">Stop the Sprite</div>
                        <div class="game-description">Perfect timing challenge</div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="high-scores">
                        <h3>üèÜ High Scores</h3>
                        <div id="highScoresList">
                            <p>Select a game to view scores</p>
                        </div>
                    </div>

                    <div class="controls-info">
                        <h3>üéÆ Controls</h3>
                        <div class="control-item">
                            <strong>Pong:</strong> W/S or ‚Üë/‚Üì arrows
                        </div>
                        <div class="control-item">
                            <strong>Snake:</strong> Arrow keys
                        </div>
                        <div class="control-item">
                            <strong>Flappy Bird:</strong> Spacebar
                        </div>
                        <div class="control-item">
                            <strong>Rhythm Timer:</strong> Spacebar
                        </div>
                        <div class="control-item">
                            <strong>Stop Sprite:</strong> Spacebar
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen">
            <div class="game-header">
                <button class="back-btn" id="backBtn">‚Üê Back to Menu</button>
                <div id="gameTitle">Game Title</div>
                <div id="gameScore">Score: 0</div>
            </div>
            <div class="game-canvas">
                <canvas id="gameCanvas" width="800" height="600"></canvas>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        class GamesPlatform {
            constructor() {
                this.currentGame = null;
                this.gameInstance = null;
                this.microbitConnected = false;
                
                this.initializeEventListeners();
                this.checkMicrobitConnection();
            }

            initializeEventListeners() {
                // Game card clicks
                document.querySelectorAll('.game-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const gameType = card.dataset.game;
                        this.startGame(gameType);
                    });

                    // Show high scores on hover
                    card.addEventListener('mouseenter', () => {
                        this.showHighScores(card.dataset.game);
                    });
                });

                // Back button
                document.getElementById('backBtn').addEventListener('click', () => {
                    this.returnToMenu();
                });

                // Keyboard events
                document.addEventListener('keydown', (e) => {
                    if (this.gameInstance && this.gameInstance.handleKeyDown) {
                        this.gameInstance.handleKeyDown(e);
                    }
                });

                document.addEventListener('keyup', (e) => {
                    if (this.gameInstance && this.gameInstance.handleKeyUp) {
                        this.gameInstance.handleKeyUp(e);
                    }
                });
            }

            async checkMicrobitConnection() {
                try {
                    const result = await ipcRenderer.invoke('setup-microbit');
                    this.updateMicrobitStatus(result.success);
                } catch (error) {
                    this.updateMicrobitStatus(false);
                }
            }

            updateMicrobitStatus(connected) {
                const status = document.getElementById('microbitStatus');
                this.microbitConnected = connected;
                
                if (connected) {
                    status.textContent = 'Microbit: Connected';
                    status.className = 'microbit-status connected';
                } else {
                    status.textContent = 'Microbit: Disconnected';
                    status.className = 'microbit-status disconnected';
                }
            }

            async showHighScores(gameType) {
                try {
                    const scores = await ipcRenderer.invoke('get-high-scores', gameType);
                    const scoresList = document.getElementById('highScoresList');
                    
                    if (scores.length === 0) {
                        scoresList.innerHTML = '<p>No scores yet!</p>';
                        return;
                    }

                    const scoresHTML = scores.map((score, index) => `
                        <div class="score-item">
                            <span>${index + 1}. ${score.name}</span>
                            <span>${score.score}</span>
                        </div>
                    `).join('');

                    scoresList.innerHTML = `
                        <h4>${gameType.charAt(0).toUpperCase() + gameType.slice(1)}</h4>
                        <div class="score-list">${scoresHTML}</div>
                    `;
                } catch (error) {
                    console.error('Error loading high scores:', error);
                }
            }

            startGame(gameType) {
                this.currentGame = gameType;
                
                // Hide main menu, show game screen
                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'flex';
                
                // Update game title
                document.getElementById('gameTitle').textContent = 
                    gameType.charAt(0).toUpperCase() + gameType.slice(1);
                
                // Initialize the specific game
                const canvas = document.getElementById('gameCanvas');
                const ctx = canvas.getContext('2d');
                
                switch(gameType) {
                    case 'pong':
                        this.gameInstance = new PongGame(canvas, ctx, this);
                        break;
                    case 'snake':
                        // this.gameInstance = new SnakeGame(canvas, ctx, this);
                        alert('Snake game coming soon!');
                        this.returnToMenu();
                        break;
                    case 'flappybird':
                        // this.gameInstance = new FlappyBirdGame(canvas, ctx, this);
                        alert('Flappy Bird game coming soon!');
                        this.returnToMenu();
                        break;
                    case 'rhythmtimer':
                        // this.gameInstance = new RhythmTimerGame(canvas, ctx, this);
                        alert('Rhythm Timer game coming soon!');
                        this.returnToMenu();
                        break;
                    case 'stopthesprite':
                        // this.gameInstance = new StopTheSpriteGame(canvas, ctx, this);
                        alert('Stop the Sprite game coming soon!');
                        this.returnToMenu();
                        break;
                }
            }

            returnToMenu() {
                if (this.gameInstance && this.gameInstance.destroy) {
                    this.gameInstance.destroy();
                }
                
                this.gameInstance = null;
                this.currentGame = null;
                
                document.getElementById('gameScreen').style.display = 'none';
                document.getElementById('mainMenu').style.display = 'block';
            }

            updateScore(score) {
                document.getElementById('gameScore').textContent = `Score: ${score}`;
            }

            async saveHighScore(playerName, score) {
                try {
                    const result = await ipcRenderer.invoke('save-high-score', this.currentGame, playerName, score);
                    return result;
                } catch (error) {
                    console.error('Error saving high score:', error);
                    return { success: false };
                }
            }

            async gameOver(score) {
                const playerName = prompt(`Game Over! Score: ${score}\nEnter your name for the high score list:`);
                
                if (playerName && playerName.trim()) {
                    const result = await this.saveHighScore(playerName.trim(), score);
                    if (result.success) {
                        alert('High score saved!');
                    }
                }
                
                setTimeout(() => {
                    this.returnToMenu();
                }, 1000);
            }
        }

        // Pong Game Implementation
        class PongGame {
            constructor(canvas, ctx, platform) {
                this.canvas = canvas;
                this.ctx = ctx;
                this.platform = platform;
                
                this.paddle1Y = canvas.height / 2 - 50;
                this.paddle2Y = canvas.height / 2 - 50;
                this.paddleSpeed = 8;
                this.paddleHeight = 100;
                this.paddleWidth = 10;
                
                this.ballX = canvas.width / 2;
                this.ballY = canvas.height / 2;
                this.ballSpeedX = 5;
                this.ballSpeedY = 3;
                this.ballSize = 10;
                
                this.score1 = 0;
                this.score2 = 0;
                this.maxScore = 5;
                
                this.keys = {};
                
                this.gameLoop = this.gameLoop.bind(this);
                this.running = true;
                this.gameLoop();
            }

            handleKeyDown(e) {
                this.keys[e.key] = true;
            }

            handleKeyUp(e) {
                this.keys[e.key] = false;
            }

            update() {
                // Player 1 controls (left paddle)
                if (this.keys['w'] || this.keys['W'] || this.keys['ArrowUp']) {
                    this.paddle1Y = Math.max(0, this.paddle1Y - this.paddleSpeed);
                }
                if (this.keys['s'] || this.keys['S'] || this.keys['ArrowDown']) {
                    this.paddle1Y = Math.min(this.canvas.height - this.paddleHeight, this.paddle1Y + this.paddleSpeed);
                }

                // Simple AI for player 2 (right paddle)
                const paddle2Center = this.paddle2Y + this.paddleHeight / 2;
                if (paddle2Center < this.ballY - 35) {
                    this.paddle2Y = Math.min(this.canvas.height - this.paddleHeight, this.paddle2Y + this.paddleSpeed * 0.7);
                } else if (paddle2Center > this.ballY + 35) {
                    this.paddle2Y = Math.max(0, this.paddle2Y - this.paddleSpeed * 0.7);
                }

                // Ball movement
                this.ballX += this.ballSpeedX;
                this.ballY += this.ballSpeedY;

                // Ball collision with top/bottom walls
                if (this.ballY <= 0 || this.ballY >= this.canvas.height) {
                    this.ballSpeedY = -this.ballSpeedY;
                }

                // Ball collision with paddles
                if (this.ballX <= this.paddleWidth && 
                    this.ballY >= this.paddle1Y && 
                    this.ballY <= this.paddle1Y + this.paddleHeight) {
                    this.ballSpeedX = -this.ballSpeedX;
                    this.ballSpeedY += (Math.random() - 0.5) * 2;
                }

                if (this.ballX >= this.canvas.width - this.paddleWidth && 
                    this.ballY >= this.paddle2Y && 
                    this.ballY <= this.paddle2Y + this.paddleHeight) {
                    this.ballSpeedX = -this.ballSpeedX;
                    this.ballSpeedY += (Math.random() - 0.5) * 2;
                }

                // Score points
                if (this.ballX < 0) {
                    this.score2++;
                    this.resetBall();
                }
                if (this.ballX > this.canvas.width) {
                    this.score1++;
                    this.resetBall();
                }

                // Update platform score display
                this.platform.updateScore(this.score1);

                // Check for game end
                if (this.score1 >= this.maxScore || this.score2 >= this.maxScore) {
                    this.running = false;
                    this.platform.gameOver(this.score1);
                }
            }

            resetBall() {
                this.ballX = this.canvas.width / 2;
                this.ballY = this.canvas.height / 2;
                this.ballSpeedX = -this.ballSpeedX;
                this.ballSpeedY = (Math.random() - 0.5) * 6;
            }

            draw() {
                // Clear canvas
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw center line
                this.ctx.setLineDash([5, 15]);
                this.ctx.beginPath();
                this.ctx.moveTo(this.canvas.width / 2, 0);
                this.ctx.lineTo(this.canvas.width / 2, this.canvas.height);
                this.ctx.strokeStyle = '#fff';
                this.ctx.stroke();
                this.ctx.setLineDash([]);

                // Draw paddles
                this.ctx.fillStyle = '#fff';
                this.ctx.fillRect(0, this.paddle1Y, this.paddleWidth, this.paddleHeight);
                this.ctx.fillRect(this.canvas.width - this.paddleWidth, this.paddle2Y, this.paddleWidth, this.paddleHeight);

                // Draw ball
                this.ctx.beginPath();
                this.ctx.arc(this.ballX, this.ballY, this.ballSize, 0, Math.PI * 2);
                this.ctx.fill();

                // Draw scores
                this.ctx.font = '48px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(this.score1, this.canvas.width / 4, 60);
                this.ctx.fillText(this.score2, 3 * this.canvas.width / 4, 60);

                // Draw instructions
                this.ctx.font = '16px Arial';
                this.ctx.fillText('W/S or ‚Üë/‚Üì to move paddle', this.canvas.width / 2, this.canvas.height - 20);
            }

            gameLoop() {
                if (this.running) {
                    this.update();
                    this.draw();
                    requestAnimationFrame(this.gameLoop);
                }
            }

            destroy() {
                this.running = false;
            }
        }

        // Initialize the platform when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.gamesPlatform = new GamesPlatform();
        });
    </script>
</body>
</html>
